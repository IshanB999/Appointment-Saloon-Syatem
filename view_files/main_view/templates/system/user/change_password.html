{% extends "main_base.html" %}
{% load i18n static%}

{% block template_css %}
{% endblock %}

{% block title %}
{{ title|default:"" }}
{% endblock %}

{% block page_title %}
<div class="block-item">
    <h4>Profile</h4>
</div>
{% endblock %}

{% block content %}
<style>
    .invalid-feedback {
        display: block !important
    }
</style>
<div id="profile-page">
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-success"> {{ message}} </div>
    {% endfor %}
    {% endif %}
    <section class="content-section">
        <div class="custom-container">
            <div class="section-content">
                <div class="common-layout-container type-reverse">
                    <div class="layout-item">
                        {% include "main_view/templates/system/user/profile_card.html" %}
                    </div>
                    <div class="layout-item">
                        <div class="common-form">
                            <div class="common-content-box">
                                <div class="box-title">
                                    <div class="title-item">
                                        <h5>Change Password</h5>
                                    </div>
                                </div>

                                <div class="box-content">
                                    <form id="update-password-form"
                                        action="{% url 'system_users_update_change_password' %}" method="POST">
                                        {% csrf_token %}
                                        <div class="fields">
                                            <div class="form-group-wrapper">
                                                <div class="form-group-item">
                                                    <div class="form-group type-password">
                                                        <label>Current Password</label>
                                                        <div class="form-inner fv-row">
                                                            <input type="password" name="current_password"
                                                                placeholder="Eg. ********">
                                                            <div class="password-toggle">
                                                                <i class="fas fa-eye" aria-hidden="true"></i>
                                                                <i class="fas fa-eye-slash" aria-hidden="true"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group type-password">
                                                        <label>New Password</label>
                                                        <div class="form-inner fv-row">
                                                            <input type="password" name="password"
                                                                placeholder="Eg. ********">
                                                            <div class="password-toggle">
                                                                <i class="fas fa-eye" aria-hidden="true"></i>
                                                                <i class="fas fa-eye-slash" aria-hidden="true"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group type-password">
                                                        <label>Confirm Password</label>
                                                        <div class="form-inner fv-row">
                                                            <input type="password" name="confirm_password"
                                                                placeholder="Eg. ********">
                                                            <div class="password-toggle">
                                                                <i class="fas fa-eye" aria-hidden="true"></i>
                                                                <i class="fas fa-eye-slash" aria-hidden="true"></i>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-action">
                                            <input type="submit" id="btn-reset-password" value="Change" class="co-btn">
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}
{% block js %}

<script>
    var id = false
    const form = document.getElementById('update-password-form');
    var validator = FormValidation.formValidation(
        form,
        {
            fields: {
                'password': {
                    validators: {
                        notEmpty: {
                            message: 'The password field is required'
                        },
                        stringLength: {
                            min: 6,
                            message: 'The password must be at least 6 characters long'
                        }
                    }
                },
                'confirm_password': {
                    validators: {
                        notEmpty: {
                            message: 'The confirm password field is required'
                        },
                        identical: {
                            compare: function () {
                                return form.querySelector('[name="password"]').value;
                            },
                            message: 'The password and confirm password must match'
                        }
                    }
                }
            },
            err: {
                clazz: 'invalid-feedback'
            },
            control: {
                // The CSS class for valid control
                valid: 'is-valid',
                // The CSS class for invalid control
                invalid: 'is-invalid'
            },
            plugins: {
                trigger: new FormValidation.plugins.Trigger(),
                bootstrap: new FormValidation.plugins.Bootstrap5({
                    rowSelector: '.fv-row',
                    eleInvalidClass: '',
                    eleValidClass: ''
                })
            }
        }
    );

    // Submit button handler
    const submitButton = document.getElementById('btn-reset-password');
    submitButton.addEventListener('click', function (e) {
        e.preventDefault();
        if (validator) {
            validator.validate().then(function (status) {
                if (status == 'Valid') {
                    save_form();
                }
            });
        }
    });
    function save_form() {
        $('#update-password-form').submit();
    }
</script>

{% endblock %}
{% extends "main_base.html" %}
{% load i18n static%}
{% block template_css %}
{% endblock %}
{% block title %}
{{ title|default:"" }}
{% endblock %}
{% block page_title %}
<div class="block-item">
    <h4>Booking</h4>
</div>
{% endblock %}
{% block content %}
<div id="common-list-page">
    <section class="content-section">
        <div class="custom-container">
            <div class="section-content">
                {% if messages %}
                {% for message in messages %}
                <div class="alert alert-success"> {{ message}} </div>
                {% endfor %}
                {% endif %}

                <div class="common-content-box">
                    <div class="common-table">
                        <div class="title-container">
                            <div class="title-item">
                                <div class="common-form type-table">
                                    <div class="fields">
                                        <div class="form-group-wrapper">
                                            <div class="form-group type-icon type-left">
                                                <span class="icon-container">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                        viewBox="0 0 24 24" fill="none">
                                                        <rect opacity="0.5" x="17.0365" y="15.1223" width="8.15546"
                                                            height="2" rx="1" transform="rotate(45 17.0365 15.1223)"
                                                            fill="currentColor" />
                                                        <path
                                                            d="M11 19C6.55556 19 3 15.4444 3 11C3 6.55556 6.55556 3 11 3C15.4444 3 19 6.55556 19 11C19 15.4444 15.4444 19 11 19ZM11 5C7.53333 5 5 7.53333 5 11C5 14.4667 7.53333 17 11 17C14.4667 17 17 14.4667 17 11C17 7.53333 14.4667 5 11 5Z"
                                                            fill="currentColor" />
                                                    </svg>
                                                </span>
                                                <input type="text" placeholder="Search Outlets"
                                                    data-ic-filter="search" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="title-item">
                                <div class="inner-item">
                                    <!-- <a href="javascript:void(0)" class="co-btn">Add Booking</a> -->
                                </div>
                            </div>
                        </div>

                        <table id="basic-datatable">
                            <thead>
                                <tr>
                                    <td>SN</td>
                                    <td>Full Name</td>
                                    <td>Email</td>
                                    <td>Mobile No</td>
                                    <td>Outlet</td>
                                    <td>Booking Date</td>
                                    <td>Booking Time</td>
                                    <td>Status</td>
                                    <td>Price</td>
                                    <td class="text-end wd-sm">Action</td>
                                </tr>
                            </thead>

                            {% csrf_token %}
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block js %}
<script>
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    var dt;
    var table;
    var KTDatatablesServerSide = function () {
        table;
        dt;
        var filterPayment;
        var e,
            t,
            n,
            r,
            o,
            a;
        // Private functions
        function initDatatable(status = true) {
            console.log(status)
            dt = $("#basic-datatable").DataTable({
                searchDelay: 500,
                processing: true,
                serverSide: true,
                ordering: false,
                pageLength: 25,
                order: [[2, 'asc']],
                stateSave: true,
                destroy: true,
                select: {
                    style: 'multi',
                    selector: 'td:first-child input[type="checkbox"]',
                    className: 'row-selected'
                },
                'ajax': { url: "{% url 'admin_booking_index' %}", type: 'POST', data: { 'csrfmiddlewaretoken': csrftoken } },
                columns: [
                    {
                        data: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        },
                        name: "sn", searchable: false, sortable: false
                    },
                    { data: "full_name", name: "full_name" },
                    { data: "email", name: "email" },
                    { data: "mobile_no", name: "mobile_no" },
                    { data: "outlet", name: "outlet" },
                    { data: "booking_date", name: "booking_date" },
                    { data: "booking_time", name: "booking_time" },
                    { data: "status", name: "status" },
                    { data: "price", name:"price"},
                   {
    data: function (data) {
        var dropdownId = 'dropdownMenuButton' + data.id;
        var buttons = '<ul class="type-action"><li><div class="dropdown">';
        buttons += `<button class="dropdown-toggle" type="button" id="${dropdownId}" data-bs-toggle="dropdown" aria-expanded="false">`;
        buttons += '<i class="flaticon-more"></i></button>';
        buttons += `<ul class="dropdown-menu" aria-labelledby="${dropdownId}">`;
        buttons += `<li><a class="dropdown-item" href="{% url 'admin_booking_detail' %}?id=${data.id}">View Booking</a></li>`;

        buttons += '</ul></div></li></ul>';
        return buttons;
    },
    name: 'action',
    searchable: false
}


                ],
                createdRow: function (row, data, dataIndex) {
                    $(row).find('td:eq(3)').attr('data-filter');
                }
            });
            var state = dt.state.loaded();
            if (state) {
                const filterSearch = document.querySelector('[data-ic-filter="search"]');
                var searchValue = state.search.search;
                filterSearch.value = searchValue
            }

            table = dt.$;
            dt.on('draw', function () {
                KTMenu.createInstances();
            });
        }
        var handleSearchDatatable = function () {
            const filterSearch = document.querySelector('[data-ic-filter="search"]');
            filterSearch.addEventListener('keyup', function (e) {
                dt.search(e.target.value).draw();
            });
        }
        return {
            init: function () {
                initDatatable();
                handleSearchDatatable();
            }
        }
    }();

    $('.alert-success').fadeOut(5000);

    function addService() {
        $('#service_id').val('');
        $('#outlet-modal').modal('show');
    }

    $(document).ready(function () {
        KTDatatablesServerSide.init();
    });
</script>
{% endblock %}
{% extends "main_base.html" %}
{% load i18n static%}
{% block template_css %}
{% endblock %}
{% block title %}
{{ title|default:"" }}
{% endblock %}
{% block page_title %}
<div class="block-item">
    <h4>Service</h4>
</div>
{% endblock %}
{% block content %}
<div id="common-list-page">
    <section class="content-section">
        <div class="custom-container">
            <div class="section-content">
                {% if messages %}
                {% for message in messages %}
                <div class="alert alert-success"> {{ message}} </div>
                {% endfor %}
                {% endif %}

                <div class="common-content-box">
                    <div class="common-table">
                        <div class="title-container">
                            <div class="title-item">
                                <div class="common-form type-table">
                                    <div class="fields">
                                        <div class="form-group-wrapper">
                                            <div class="form-group type-icon type-left">
                                                <span class="icon-container">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                        viewBox="0 0 24 24" fill="none">
                                                        <rect opacity="0.5" x="17.0365" y="15.1223" width="8.15546"
                                                            height="2" rx="1" transform="rotate(45 17.0365 15.1223)"
                                                            fill="currentColor" />
                                                        <path
                                                            d="M11 19C6.55556 19 3 15.4444 3 11C3 6.55556 6.55556 3 11 3C15.4444 3 19 6.55556 19 11C19 15.4444 15.4444 19 11 19ZM11 5C7.53333 5 5 7.53333 5 11C5 14.4667 7.53333 17 11 17C14.4667 17 17 14.4667 17 11C17 7.53333 14.4667 5 11 5Z"
                                                            fill="currentColor" />
                                                    </svg>
                                                </span>
                                                <input type="text" placeholder="Search Outlets"
                                                    data-ic-filter="search" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="title-item">
                                <div class="inner-item">
                                    <a href="javascript:void(0)" onclick="addService()" class="co-btn">Add
                                        Outlet</a>
                                </div>
                            </div>
                        </div>

                        <table id="basic-datatable">
                            
                            <thead>
                                <tr>
                                    <td>SN</td>
                                    <td>Name</td>
                                    <td>Gender</td>
                                    <td>Code</td>
                                    <td class="text-end wd-sm">Action</td>
                                </tr>
                            </thead>

                            {% csrf_token %}
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<div id="outlet-modal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <form id="service-form" action="{% url 'admin_service_store' %}" method="POST">
                {% csrf_token %}
                <input type="hidden" name="id" id="service_id">
                <div class="modal-body">
                    <div class="layout-item">
                        <div class="common-form">
                            <div class="fields">
                                <div class="form-group-wrapper">
                                    <div class="form-group-item">
                                        <div class="form-group fv-row">
                                            <label>{% trans "Name" %}</label>
                                            <input type="text" name="name" id="name" placeholder="{% trans 'Name' %}" />
                                        </div>
                                        <div class="form-group fv-row">
                                            <label>{% trans "Gender" %}</label>
                                            <select name="gender" id="gender">
                                                <option value="Gents">Gents</option>
                                                <option value="Ladies">Ladies</option>
                                            </select>
                                        </div>
                                        <div class="form-group fv-row">
                                            <label>{% trans "Code" %}</label>
                                            <input type="text" name="code" id="code" placeholder="{% trans 'Code' %}" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Save</button>
                    <button type="button" class="btn btn-default" id="close-modal">Close</button>
                </div>
            </form>
        </div>

    </div>
</div>
{% endblock %}

{% block js %}
<script>
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    var dt;
    var table;
    var KTDatatablesServerSide = function () {
        table;
        dt;
        var filterPayment;
        var e,
            t,
            n,
            r,
            o,
            a;
        // Private functions
        function initDatatable(status = true) {
            console.log(status)
            dt = $("#basic-datatable").DataTable({
                searchDelay: 500,
                processing: true,
                serverSide: true,
                ordering: false,
                pageLength: 25,
                order: [[2, 'asc']],
                stateSave: true,
                destroy: true,
                select: {
                    style: 'multi',
                    selector: 'td:first-child input[type="checkbox"]',
                    className: 'row-selected'
                },
                'ajax': { url: "{% url 'admin_service_index' %}", type: 'POST', data: { 'csrfmiddlewaretoken': csrftoken } },
                columns: [
                    {
                        data: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        },
                        name: "sn", searchable: false, sortable: false
                    },
                    { data: "name", name: "name" },
                    { data: "gender", name: "gender" },
                    { data: "code", name: "code" },
                    {
                        data: function (data, b, c, table) {
                            var buttons = '';
                            buttons += '<td>'
                            buttons += '<ul class="type-action">'
                            buttons += '<li>'
                            buttons += '<div class="dropdown">'
                            buttons += '<button class="dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">'
                            buttons += '<i class="flaticon-more"></i>'
                            buttons += '</button>'
                            buttons += '<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">'
                            buttons += '<li><a class="dropdown-item" onClick="editService(' + table.row + ')" >Edit</a></li>'
                            buttons += '<li><a class="dropdown-item type-delete" onclick="delete_json(' + data.id + ')" href="javascript::void(0)" title="Delete">Delete</a></li>'
                            buttons += '</ul>'
                            buttons += '</div>'
                            buttons += '</li>'
                            buttons += '</ul>'
                            buttons += '</td>'
                            return buttons
                        }, name: 'action', searchable: false
                    },
                ],
                createdRow: function (row, data, dataIndex) {
                    $(row).find('td:eq(3)').attr('data-filter');
                }
            });
            var state = dt.state.loaded();
            if (state) {
                const filterSearch = document.querySelector('[data-ic-filter="search"]');
                var searchValue = state.search.search;
                filterSearch.value = searchValue
            }

            table = dt.$;
            dt.on('draw', function () {
                KTMenu.createInstances();
            });
        }
        var handleSearchDatatable = function () {
            const filterSearch = document.querySelector('[data-ic-filter="search"]');
            filterSearch.addEventListener('keyup', function (e) {
                dt.search(e.target.value).draw();
            });
        }
        return {
            init: function () {
                initDatatable();
                handleSearchDatatable();
            }
        }
    }();

    $('.alert-success').fadeOut(5000);

    function addService() {
        $('#service_id').val('');
        $('#outlet-modal').modal('show');
    }

    $('#close-modal').click(function () {
        $('#outlet-modal').modal('hide');
    })

    $(document).ready(function () {
        KTDatatablesServerSide.init();
    });

    function editService(index) {
        var row = dt.row(index).data();
        $('#service_id').val(row.id);
        $("#service-form").find('input:checkbox').prop('checked', false);
        $("#service-form").find('input:text,select,textarea').val(function (i, v) {

            /*if(row.gender == 'M')
            {
                $('input:radio[name=gender][id=radio_1]').prop('checked',true);
            }else{
                $('input:radio[name=gender][id=radio_2]').prop('checked',true);
            }*/
            return row[this.name];
        });

        let enabled = false;
        if (row.id !== '') {
            enabled = false;
            id = $('#id').val();
        }
        $('#outlet-modal').modal('show');
    }

    function delete_json(id) {
        alertify.confirm('Do you want to delete this item?', function () {
            $.post("{% url 'admin_service_delete' %}", { id: id, csrfmiddlewaretoken: csrftoken }, function () {
                dt.ajax.reload(null, false);
            });
        });
    }





</script>
{% endblock %}